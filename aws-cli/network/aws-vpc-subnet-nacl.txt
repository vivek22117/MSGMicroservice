#VALIDATE TEMPLATE
aws cloudformation validate-template --template-body file://cloudformation/network/aws-vpc-subnet-nacl.json

#Creaate cloudformation
aws --profile yash cloudformation create-stack \
--stack-name vpc-subnet-nacl-by-vivek \
--template-body file://cloudformation/network/aws-vpc-subnet-nacl.json \
--parameters ParameterKey=VPCStackName,ParameterValue=vpc-subnet-network-by-vivek


#GRAB VPCID FOR FUTURE USE
VPC_ID=$(aws --profile yash ec2 describe-vpcs \
--filters "Name=tag:Name, Values=double-digit-vpc" \
--query 'Vpcs[0].VpcId' --output text)

#DESCRIBE STACK CREATION EVENTS
aws --profile yash cloudformation describe-stack-events \
--stack-name vpc-subnet-nacl-by-vivek \
--query "StackEvents[].[{Resource:LogicalResourceId,Status:ResourceStatus,Reason:ResourceStatusReason}]" \
--output table

#WAIT FOR STACK TO FINISH
aws --profile yash cloudformation wait stack-create-complete --stack-name vpc-subnet-nacl-by-vivek

#list NACL entries
aws -profile yash ec2 describe-networ-acls \
--filters "Name=vpc-id, Values=${VPC_ID}" "Name=tag:aws:cloudformation:stack-name, Values=vpc-subnet-nacl-by-vivek" \
--query "NetworkAcls[].Entries[]"

